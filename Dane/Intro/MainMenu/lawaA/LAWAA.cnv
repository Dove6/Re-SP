OBJECT=IREXSTONEPOS
IREXSTONEPOS:TYPE=INTEGER
IREXSTONEPOS:VALUE=0

OBJECT=IREXSTONEPOSPREV
IREXSTONEPOSPREV:TYPE=INTEGER
IREXSTONEPOSPREV:VALUE=0


######################################
##############  ARRAY  ###############
######################################

OBJECT=ARRPATTERN
ARRPATTERN:TYPE=ARRAY

OBJECT=ARRTRANSITIONS
ARRTRANSITIONS:TYPE=MULTIARRAY
ARRTRANSITIONS:DIMENSIONS=2


######################################
##############  STRUCT  ##############
######################################

OBJECT=STRREXPIXELPOSORIG
STRREXPIXELPOSORIG:TYPE=STRUCT
STRREXPIXELPOSORIG:FIELDS=X<INTEGER>,Y<INTEGER>

OBJECT=STRREXPIXELPOSDEST
STRREXPIXELPOSDEST:TYPE=STRUCT
STRREXPIXELPOSDEST:FIELDS=X<INTEGER>,Y<INTEGER>

OBJECT=STRSTONEDATA
STRSTONEDATA:TYPE=STRUCT
STRSTONEDATA:FIELDS=POSX<INTEGER>,POSY<INTEGER>,INITEVT<STRING>

OBJECT=STRTRANSITION
STRTRANSITION:TYPE=STRUCT
STRTRANSITION:FIELDS=ORIG<INTEGER>,DEST<INTEGER>,DIRECTION<STRING>


######################################
#############  DATABASE  #############
######################################

OBJECT=DTBSTONEDATA
DTBSTONEDATA:TYPE=DATABASE
DTBSTONEDATA:MODEL=STRSTONEDATA

OBJECT=DTBTRANSITIONS
DTBTRANSITIONS:TYPE=DATABASE
DTBTRANSITIONS:MODEL=STRTRANSITION


######################################
##############  ANIMO  ###############
######################################

OBJECT=ANNBUBBLES1
ANNBUBBLES1:TYPE=ANIMO
ANNBUBBLES1:VISIBLE=TRUE
ANNBUBBLES1:FILENAME=BOMBEL1_1.ANN
ANNBUBBLES1:TOCANVAS=TRUE
ANNBUBBLES1:PRIORITY=0
ANNBUBBLES1:PRELOAD=TRUE
ANNBUBBLES1:ONFINISHED={THIS^PLAY("PLAY");}

OBJECT=ANNBUBBLES2
ANNBUBBLES2:TYPE=ANIMO
ANNBUBBLES2:VISIBLE=TRUE
ANNBUBBLES2:FILENAME=BOMBEL1_2.ANN
ANNBUBBLES2:TOCANVAS=TRUE
ANNBUBBLES2:PRIORITY=0
ANNBUBBLES2:PRELOAD=TRUE
ANNBUBBLES2:ONFINISHED={THIS^PLAY("PLAY");}

OBJECT=ANNBUBBLES3
ANNBUBBLES3:TYPE=ANIMO
ANNBUBBLES3:VISIBLE=TRUE
ANNBUBBLES3:FILENAME=BOMBEL1_3.ANN
ANNBUBBLES3:TOCANVAS=TRUE
ANNBUBBLES3:PRIORITY=0
ANNBUBBLES3:PRELOAD=TRUE
ANNBUBBLES3:ONFINISHED={THIS^PLAY("PLAY");}

OBJECT=ANNSTONE
ANNSTONE:TYPE=ANIMO
ANNSTONE:FILENAME=STONE.ANN
ANNSTONE:VISIBLE=FALSE
ANNSTONE:PRIORITY=1
ANNSTONE:PRELOAD=TRUE
ANNSTONE:ONFINISHED^ZAPADA={THIS^PLAY("WYNURZA");}

OBJECT=ANNREX
ANNREX:TYPE=ANIMO
ANNREX:VISIBLE=TRUE
ANNREX:FILENAME=REKSIO18.ANN
ANNREX:TOCANVAS=TRUE
ANNREX:PRIORITY=2
ANNREX:PRELOAD=TRUE
ANNREX:ONFINISHED^ZPLANSZY17={BEHENABLEBUTTONS^RUN();}
ANNREX:ONFINISHED^PRZYPALONY=BEHSTARTGAME
ANNREX:ONFINISHED^TRAFIONY=BEHSTARTGAME
ANNREX:ONSTARTED^SPADA={@IF("VARLAWAZYCIA'1","{SNDHINT^PLAY();VARLAWAZYCIA^SET(5);}","");}
ANNREX:ONFINISHED^SPADA={VARLAWA^SET(0);BEHENABLEBUTTONS^RUN();}
ANNREX:ONFINISHED^E=BEHJUMPEND
ANNREX:ONFINISHED^W=BEHJUMPEND
ANNREX:ONFINISHED^NE=BEHJUMPEND
ANNREX:ONFINISHED^NW=BEHJUMPEND
ANNREX:ONFINISHED^SE=BEHJUMPEND
ANNREX:ONFINISHED^SW=BEHJUMPEND
ANNREX:ONFRAMECHANGED^E=BEHJUMPING
ANNREX:ONFRAMECHANGED^W=BEHJUMPING
ANNREX:ONFRAMECHANGED^NE=BEHJUMPING
ANNREX:ONFRAMECHANGED^NW=BEHJUMPING
ANNREX:ONFRAMECHANGED^SE=BEHJUMPING
ANNREX:ONFRAMECHANGED^SW=BEHJUMPING
ANNREX:ONFINISHED^OGLADAMEPE={RATUNEK^GOTO("MAPAPELNA");}
ANNREX:ONFINISHED^DOPLANSZY17={RATUNEK^GOTO("CIEMNOSC");}
ANNREX:ONFINISHED^DOPLANSZY21={RATUNEK^GOTO("LAWAB");}

OBJECT=ANNFALLINGROCK1
ANNFALLINGROCK1:TYPE=ANIMO
ANNFALLINGROCK1:VISIBLE=TRUE
ANNFALLINGROCK1:FILENAME=KAMIEN1.ANN
ANNFALLINGROCK1:TOCANVAS=TRUE
ANNFALLINGROCK1:PRIORITY=3
ANNFALLINGROCK1:PRELOAD=TRUE
ANNFALLINGROCK1:ONFINISHED^PAUSE={THIS^PLAY("SPADA");}
ANNFALLINGROCK1:ONFINISHED^SPADA={THIS^PLAY("END");}
ANNFALLINGROCK1:ONSTARTED^END={@IF("IREXSTONEPOS'2","BEHREXCRUSHING","");}
ANNFALLINGROCK1:ONFINISHED^END={THIS^PLAY("PAUSE");}

OBJECT=ANNFALLINGROCK2
ANNFALLINGROCK2:TYPE=ANIMO
ANNFALLINGROCK2:VISIBLE=TRUE
ANNFALLINGROCK2:FILENAME=KAMIEN2.ANN
ANNFALLINGROCK2:TOCANVAS=TRUE
ANNFALLINGROCK2:PRIORITY=3
ANNFALLINGROCK2:PRELOAD=TRUE
ANNFALLINGROCK2:ONFINISHED^PAUSE={THIS^PLAY("SPADA");}
ANNFALLINGROCK2:ONFINISHED^SPADA={THIS^PLAY("END");}
ANNFALLINGROCK2:ONSTARTED^END={@IF("IREXSTONEPOS'8","BEHREXCRUSHING","");}
ANNFALLINGROCK2:ONFINISHED^END={THIS^PLAY("PAUSE");}


######################################
##############  IMAGE  ###############
######################################

OBJECT=IMGOVERLAY
IMGOVERLAY:TYPE=IMAGE
IMGOVERLAY:VISIBLE=TRUE
IMGOVERLAY:FILENAME=NAKLADKA1.IMG
IMGOVERLAY:TOCANVAS=TRUE
IMGOVERLAY:PRIORITY=10
IMGOVERLAY:PRELOAD=TRUE

OBJECT=IMGGOTO17
IMGGOTO17:TYPE=IMAGE
IMGGOTO17:VISIBLE=TRUE
IMGGOTO17:FILENAME=LAWAAGOTO17.IMG
IMGGOTO17:TOCANVAS=TRUE
IMGGOTO17:PRIORITY=11
IMGGOTO17:PRELOAD=TRUE

OBJECT=IMGMAPOVERSTD
IMGMAPOVERSTD:TYPE=IMAGE
IMGMAPOVERSTD:VISIBLE=TRUE
IMGMAPOVERSTD:FILENAME=BMAPA.IMG
IMGMAPOVERSTD:TOCANVAS=TRUE
IMGMAPOVERSTD:PRIORITY=20
IMGMAPOVERSTD:PRELOAD=TRUE

OBJECT=IMGMAPOVEROC
IMGMAPOVEROC:TYPE=IMAGE
IMGMAPOVEROC:VISIBLE=TRUE
IMGMAPOVEROC:FILENAME=BMAPAOC.IMG
IMGMAPOVEROC:TOCANVAS=TRUE
IMGMAPOVEROC:PRIORITY=20
IMGMAPOVEROC:PRELOAD=TRUE

OBJECT=IMGMAPOVEROM
IMGMAPOVEROM:TYPE=IMAGE
IMGMAPOVEROM:VISIBLE=TRUE
IMGMAPOVEROM:FILENAME=BMAPAOM.IMG
IMGMAPOVEROM:TOCANVAS=TRUE
IMGMAPOVEROM:PRIORITY=20
IMGMAPOVEROM:PRELOAD=TRUE

OBJECT=IMGMAPUNDERSTD
IMGMAPUNDERSTD:TYPE=IMAGE
IMGMAPUNDERSTD:VISIBLE=TRUE
IMGMAPUNDERSTD:FILENAME=BMAPA2.IMG
IMGMAPUNDERSTD:TOCANVAS=TRUE
IMGMAPUNDERSTD:PRIORITY=20
IMGMAPUNDERSTD:PRELOAD=TRUE

OBJECT=IMGMAPUNDEROC
IMGMAPUNDEROC:TYPE=IMAGE
IMGMAPUNDEROC:VISIBLE=TRUE
IMGMAPUNDEROC:FILENAME=BMAPA2OC.IMG
IMGMAPUNDEROC:TOCANVAS=TRUE
IMGMAPUNDEROC:PRIORITY=20
IMGMAPUNDEROC:PRELOAD=TRUE

OBJECT=IMGMAPUNDEROM
IMGMAPUNDEROM:TYPE=IMAGE
IMGMAPUNDEROM:VISIBLE=TRUE
IMGMAPUNDEROM:FILENAME=BMAPA2OM.IMG
IMGMAPUNDEROM:TOCANVAS=TRUE
IMGMAPUNDEROM:PRIORITY=20
IMGMAPUNDEROM:PRELOAD=TRUE

OBJECT=IMGMENUSTD
IMGMENUSTD:TYPE=IMAGE
IMGMENUSTD:VISIBLE=TRUE
IMGMENUSTD:FILENAME=BEXIT.IMG
IMGMENUSTD:TOCANVAS=TRUE
IMGMENUSTD:PRIORITY=20
IMGMENUSTD:PRELOAD=TRUE

OBJECT=IMGMENUOC
IMGMENUOC:TYPE=IMAGE
IMGMENUOC:VISIBLE=TRUE
IMGMENUOC:FILENAME=BEXITOC.IMG
IMGMENUOC:TOCANVAS=TRUE
IMGMENUOC:PRIORITY=20
IMGMENUOC:PRELOAD=TRUE

OBJECT=IMGMENUOM
IMGMENUOM:TYPE=IMAGE
IMGMENUOM:VISIBLE=TRUE
IMGMENUOM:FILENAME=BEXITOM.IMG
IMGMENUOM:TOCANVAS=TRUE
IMGMENUOM:PRIORITY=20
IMGMENUOM:PRELOAD=TRUE


######################################
##############  BUTTON  ##############
######################################

OBJECT=BTNSTONE
BTNSTONE:TYPE=BUTTON
BTNSTONE:VISIBLE=TRUE
BTNSTONE:ENABLE=TRUE

OBJECT=BTNGOTO17
BTNGOTO17:TYPE=BUTTON
BTNGOTO17:VISIBLE=TRUE
BTNGOTO17:ENABLE=TRUE
BTNGOTO17:RECT=0,280,80,530
BTNGOTO17:GFXONMOVE=IMGGOTO17
BTNGOTO17:ONACTION={@IF("IREXSTONEPOS'0","{BEHDISABLEBUTTONS^RUN();ANNREX^PLAY("DOPLANSZY17");}","");}

OBJECT=BTNFINISH
BTNFINISH:TYPE=BUTTON
BTNFINISH:VISIBLE=TRUE
BTNFINISH:ENABLE=TRUE
BTNFINISH:RECT=700,480,800,530
BTNFINISH:ONACTION={STRREXPIXELPOSORIG|X^SET(STRREXPIXELPOSDEST|X);STRREXPIXELPOSORIG|Y^SET(STRREXPIXELPOSDEST|Y);STRREXPIXELPOSDEST|X^SET(698);STRREXPIXELPOSDEST|Y^SET(527);BEHJUMPSTART^RUN(10);}

OBJECT=BTNMAPOVER
BTNMAPOVER:TYPE=BUTTON
BTNMAPOVER:VISIBLE=TRUE
BTNMAPOVER:ENABLE=TRUE
BTNMAPOVER:GFXSTANDARD=IMGMAPOVERSTD
BTNMAPOVER:GFXONCLICK=IMGMAPOVEROC
BTNMAPOVER:GFXONMOVE=IMGMAPOVEROM
BTNMAPOVER:ONACTION={@IF("IREXSTONEPOS'0","{BEHDISABLEBUTTONS^RUN();ANNREX^PLAY("OGLADAMEPE");}","{SNDMAPBLOCK^PLAY();}");}

OBJECT=BTNMAPUNDER
BTNMAPUNDER:TYPE=BUTTON
BTNMAPUNDER:VISIBLE=TRUE
BTNMAPUNDER:ENABLE=TRUE
BTNMAPUNDER:GFXSTANDARD=IMGMAPUNDERSTD
BTNMAPUNDER:GFXONCLICK=IMGMAPUNDEROC
BTNMAPUNDER:GFXONMOVE=IMGMAPUNDEROM
BTNMAPUNDER:ONACTION={@IF("IREXSTONEPOS'0","{BEHDISABLEBUTTONS^RUN();RATUNEK^GOTO("MAPAPODZIEMI");}","{SNDMAPBLOCK^PLAY();}");}

OBJECT=BTNMENU
BTNMENU:TYPE=BUTTON
BTNMENU:VISIBLE=TRUE
BTNMENU:ENABLE=TRUE
BTNMENU:GFXSTANDARD=IMGMENUSTD
BTNMENU:GFXONCLICK=IMGMENUOC
BTNMENU:GFXONMOVE=IMGMENUOM
BTNMENU:ONACTION={RATUNEK^GOTO("MENUGLOWNE");}


######################################
##############  SOUND  ###############
######################################

OBJECT=SNDSUCCESS
SNDSUCCESS:TYPE=SOUND
SNDSUCCESS:FILENAME=18DOSKONALE.WAV
SNDSUCCESS:PRELOAD=TRUE
SNDSUCCESS:ONFINISHED={ANNREX^PLAY("DOPLANSZY21");}

OBJECT=SNDHINT
SNDHINT:TYPE=SOUND
SNDHINT:FILENAME=18HINT.WAV
SNDHINT:PRELOAD=TRUE

OBJECT=SNDMAPBLOCK
SNDMAPBLOCK:TYPE=SOUND
SNDMAPBLOCK:FILENAME=NOWE10.WAV
SNDMAPBLOCK:PRELOAD=TRUE


######################################
############  BEHAVIOUR  #############
######################################

OBJECT=BEHENTRYFROMUI
BEHENTRYFROMUI:TYPE=BEHAVIOUR
BEHENTRYFROMUI:CODE={@IF("POZYCJAREKSIA'101","{ANNREX^PLAY("ODKLADAMAPE");}","{ANNREX^SETFRAME("DOPLANSZY17",0);}");}

OBJECT=BEHENTRY
BEHENTRY:TYPE=BEHAVIOUR
BEHENTRY:CODE={BEHDISABLEBUTTONS^RUN();@IF("POZYCJAWULKAN'17","{ANNREX^PLAY("ZPLANSZY17");}","{ANNREX^PLAY("SPADA");}");}

OBJECT=BEHSTARTGAME
BEHSTARTGAME:TYPE=BEHAVIOUR
BEHSTARTGAME:CODE={ANNREX^SETPOSITION(9,498);STRREXPIXELPOSORIG|X^SET(0);STRREXPIXELPOSORIG|Y^SET(0);STRREXPIXELPOSDEST|X^SET(9);STRREXPIXELPOSDEST|Y^SET(498);IREXSTONEPOS^SET(0);IREXSTONEPOSPREV^SET(0);@IF("POZYCJAREKSIA'100||POZYCJAREKSIA'101||POZYCJAREKSIA'102","BEHENTRYFROMUI","BEHENTRY");}

OBJECT=BEHENABLEBUTTONS
BEHENABLEBUTTONS:TYPE=BEHAVIOUR
BEHENABLEBUTTONS:CODE={@LOOP("{*["BTNSTONE_"+_I_]^ENABLE();}",1,9,1);@IF("IREXSTONEPOS'0","{BTNGOTO17^ENABLE();}","");BTNFINISH^ENABLE();BTNMAPOVER^ENABLE();BTNMAPUNDER^ENABLE();}

OBJECT=BEHDISABLEBUTTONS
BEHDISABLEBUTTONS:TYPE=BEHAVIOUR
BEHDISABLEBUTTONS:CODE={@LOOP("{*["BTNSTONE_"+_I_]^DISABLEBUTVISIBLE();}",1,9,1);BTNGOTO17^DISABLEBUTVISIBLE();BTNFINISH^DISABLEBUTVISIBLE();BTNMAPOVER^DISABLEBUTVISIBLE();BTNMAPUNDER^DISABLEBUTVISIBLE();}

OBJECT=BEHSTONEACTION
BEHSTONEACTION:TYPE=BEHAVIOUR
BEHSTONEACTION:CODE={@INT("L_IINDEX",THIS^GETCLONEINDEX());STRREXPIXELPOSORIG|X^SET(STRREXPIXELPOSDEST|X);STRREXPIXELPOSORIG|Y^SET(STRREXPIXELPOSDEST|Y);DTBSTONEDATA^SELECT([L_IINDEX-1]);STRSTONEDATA^SET("DTBSTONEDATA_CURSOR");STRREXPIXELPOSDEST|X^SET(STRSTONEDATA|POSX);STRREXPIXELPOSDEST|Y^SET(STRSTONEDATA|POSY);BEHJUMPSTART^RUN(L_IINDEX);}

OBJECT=BEHJUMPSTART
BEHJUMPSTART:TYPE=BEHAVIOUR
BEHJUMPSTART:CODE={@STRING("L_SDIRECTION",ARRTRANSITIONS^GET(IREXSTONEPOS,$1));@IF("L_SDIRECTION!'"NULL"","{IREXSTONEPOSPREV^SET(IREXSTONEPOS);IREXSTONEPOS^SET($1);BEHDISABLEBUTTONS^RUN();ANNREX^PLAY(L_SDIRECTION);}","");}

OBJECT=BEHJUMPING
BEHJUMPING:TYPE=BEHAVIOUR
BEHJUMPING:CODE={@INT("L_IPOSX",[STRREXPIXELPOSDEST|X-STRREXPIXELPOSORIG|X]);L_IPOSX^MUL([ANNREX^GETCFRAMEINEVENT()+1]);L_IPOSX^DIV(THIS^GETNOFINEVENT(THIS^GETEVENTNAME()));@INT("L_IPOSY",[STRREXPIXELPOSDEST|Y-STRREXPIXELPOSORIG|Y]);L_IPOSY^MUL([ANNREX^GETCFRAMEINEVENT()+1]);L_IPOSY^DIV(THIS^GETNOFINEVENT(THIS^GETEVENTNAME()));THIS^SETPOSITION([STRREXPIXELPOSORIG|X+L_IPOSX],[STRREXPIXELPOSORIG|Y+L_IPOSY]);}

OBJECT=BEHJUMPEND
BEHJUMPEND:TYPE=BEHAVIOUR
BEHJUMPEND:CODE={BEHENABLEBUTTONS^RUN();@BOOL("L_BPATTERNOK",TRUE);@INT("L_IPATTERNPOS1",ARRPATTERN^FIND(IREXSTONEPOSPREV));@INT("L_IPATTERNPOS2",ARRPATTERN^FIND(IREXSTONEPOS));@INT("L_IPATTERNDIFF",[L_IPATTERNPOS1-L_IPATTERNPOS2]);@IF("L_IPATTERNPOS1<0||L_IPATTERNPOS2<0","{L_BPATTERNOK^SET(FALSE);}","{L_IPATTERNDIFF^ABS(L_IPATTERNDIFF);}");@IF("L_IPATTERNDIFF>1","{L_BPATTERNOK^SET(FALSE);}","");@IF("L_BPATTERNOK'FALSE","BEHREXDEEPFRYING","");@IF("IREXSTONEPOS'10","{BEHDISABLEBUTTONS^RUN();SNDSUCCESS^PLAY();}","");}

OBJECT=BEHREXDEEPFRYING
BEHREXDEEPFRYING:TYPE=BEHAVIOUR
BEHREXDEEPFRYING:CODE={VARLAWA^SET(1);BEHDISABLEBUTTONS^RUN();*["ANNSTONE_"+IREXSTONEPOS]^PLAY("ZAPADA");ANNREX^PLAY("PRZYPALONY");IREXSTONEPOS^SET(0);IREXSTONEPOSPREV^SET(0);VARLAWAZYCIA^DEC();}

OBJECT=BEHREXCRUSHING
BEHREXCRUSHING:TYPE=BEHAVIOUR
BEHREXCRUSHING:CODE={VARLAWA^SET(1);BEHDISABLEBUTTONS^RUN();ANNREX^PLAY("TRAFIONY");IREXSTONEPOS^SET(0);IREXSTONEPOSPREV^SET(0);VARLAWAZYCIA^DEC();}

OBJECT=BEHINITARRAYS
BEHINITARRAYS:TYPE=BEHAVIOUR
BEHINITARRAYS:CODE={ARRPATTERN^ADD(0,1,2,7,8,4,5,10);DTBTRANSITIONS^SELECT(0);@LOOP("{STRTRANSITION^SET("DTBTRANSITIONS_CURSOR");ARRTRANSITIONS^SET(STRTRANSITION|ORIG,STRTRANSITION|DEST,STRTRANSITION|DIRECTION);DTBTRANSITIONS^NEXT();}",1,DTBTRANSITIONS^GETROWSNO(),1);}

OBJECT=BEHGENERATESTONES
BEHGENERATESTONES:TYPE=BEHAVIOUR
BEHGENERATESTONES:CODE={DTBSTONEDATA^SELECT(0);@LOOP("{STRSTONEDATA^SET("DTBSTONEDATA_CURSOR");ANNSTONE^CLONE(1);*["ANNSTONE_"+_I_]^SETPOSITION(STRSTONEDATA|POSX,STRSTONEDATA|POSY);*["ANNSTONE_"+_I_]^PLAY(STRSTONEDATA|INITEVT);BTNSTONE^CLONE(1);*["BTNSTONE_"+_I_]^SETSTD(["ANNSTONE_"+_I_]);*["BTNSTONE_"+_I_]^ADDBEHAVIOUR("ONACTION","BEHSTONEACTION");DTBSTONEDATA^NEXT();}",1,DTBSTONEDATA^GETROWSNO(),1);}

OBJECT=__INIT__
__INIT__:TYPE=BEHAVIOUR
__INIT__:CODE={BEHINITSCENEMUSIC^RUN(); !VARIABLES_INIT; DTBTRANSITIONS^LOAD("TRANSITIONS.DTA");DTBSTONEDATA^LOAD("STONES.DTA");BEHINITARRAYS^RUN(); !ANIMATIONS_INIT; BEHGENERATESTONES^RUN();ANNBUBBLES1^PLAY("PLAY");ANNBUBBLES2^PLAY("PLAY");ANNBUBBLES3^PLAY("PLAY");ANNFALLINGROCK1^PLAY("PAUSE");ANNFALLINGROCK2^PLAY("PAUSE");BEHSTARTGAME^RUN(); POZYCJAREKSIA^SET("WULKAN");POZYCJAWULKAN^SET(18);SAVEROZDZIAL6^SET("LAWAA");}

